import networkx as nx
import matplotlib.pyplot as plt
import random

TAMANHO = 20  # Grid 20x20

CUSTO_GRAMA = 1
CUSTO_FLORESTA = 5
CUSTO_AGUA = 20  # Muito caro, o A* vai evitar ao máximo

print(f"Gerando mundo RPG {TAMANHO}x{TAMANHO}...")

G = nx.grid_2d_graph(TAMANHO, TAMANHO)
inicio = (0, 0)
objetivo = (TAMANHO - 1, TAMANHO - 1)

tipo_terreno = {} 

for node in G.nodes():
    
    if node == inicio or node == objetivo:
        tipo_terreno[node] = 'grama'
        continue
    
    if sorteio < 0.60:
        tipo_terreno[node] = 'grama'
    elif sorteio < 0.80:
        tipo_terreno[node] = 'floresta'
    elif sorteio < 0.90:
        tipo_terreno[node] = 'agua'
    else:
        tipo_terreno[node] = 'muro'

nos_para_remover = []

for node in G.nodes():
    terreno = tipo_terreno[node]
    
    if terreno == 'muro':
        nos_para_remover.append(node)
    else:
        peso = CUSTO_GRAMA
        if terreno == 'floresta': peso = CUSTO_FLORESTA
        elif terreno == 'agua': peso = CUSTO_AGUA
        
        
        for vizinho in G.neighbors(node):
            G[node][vizinho]['weight'] = peso

G.remove_nodes_from(nos_para_remover)
def heuristica(a, b):
    return abs(a[0] - b[0]) + abs(a[1] - b[1])

print("Calculando a melhor rota considerando os terrenos...")
caminho = []
custo_total = 0

try:
    caminho = nx.astar_path(G, inicio, objetivo, heuristic=heuristica, weight='weight')
    custo_total = sum(G[u][v]['weight'] for u, v in zip(caminho[:-1], caminho[1:]))
    print(f"SUCESSO! Passos: {len(caminho)} | Custo (Esforço): {custo_total}")
except nx.NetworkXNoPath:
    print("O mapa gerado bloqueou o caminho totalmente. Tente novamente.")
plt.figure(figsize=(10, 10))
pos = {node: node for node in G.nodes()}

nos_grama = [n for n in G.nodes() if tipo_terreno[n] == 'grama']
nos_floresta = [n for n in G.nodes() if tipo_terreno[n] == 'floresta']
nos_agua = [n for n in G.nodes() if tipo_terreno[n] == 'agua']

nx.draw_networkx_nodes(G, pos, nodelist=nos_grama, node_size=60, node_color='lightgreen', label='Grama (1)')
nx.draw_networkx_nodes(G, pos, nodelist=nos_floresta, node_size=60, node_color='darkgreen', label='Floresta (5)')
nx.draw_networkx_nodes(G, pos, nodelist=nos_agua, node_size=60, node_color='blue', label='Água (20)')

nx.draw_networkx_nodes(G, pos, nodelist=[inicio], node_size=300, node_color='white', edgecolors='black', label='Início')
nx.draw_networkx_nodes(G, pos, nodelist=[objetivo], node_size=300, node_color='black', label='Objetivo')

if caminho:
    
    arestas_caminho = list(zip(caminho, caminho[1:]))
    nx.draw_networkx_edges(G, pos, edgelist=arestas_caminho, edge_color='red', width=4, label='Rota A*')

plt.title(f"A* em Mapa RPG Aleatório\nCusto Total: {custo_total}")
plt.legend(loc='upper left', framealpha=0.9)
plt.axis('off')

plt.savefig("mapa_rpg_final.png", dpi=300)
print("\nImagem salva como 'mapa_rpg_final.png'.")
plt.show()
